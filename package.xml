<?xml version="1.0" encoding="UTF-8"?>
<project name="Minesweeper" default="dist" basedir="." xmlns:fx="javafx:com.sun.javafx.tools.ant">

  <!-- Task Definition -->
  <taskdef resource="com/sun/javafx/tools/ant/antlib.xml"
           uri="javafx:com.sun.javafx.tools.ant"
           classpath=".:${maven.dependency.com.oracle.ant-javafx.jar.path}"/>

  <fx:application id="minesweeper"
                  name="${project.name}"
                  mainClass="${project.javaFX.mainClass}"/>

  <fx:resources id="appRes">
    <fx:fileset dir="${project.build.directory}" includes="${project.name}.jar"/>
  </fx:resources>

  <!-- Produces the Jar file with proper manifest -->
  <target name="jar">
    <fx:jar destfile="${project.build.directory}/${project.name}.jar">
      <fx:application refid="minesweeper"/>

      <manifest>
        <attribute name="Implementation-Vendor" value="${project.vendor}"/>
        <attribute name="Implementation-Title" value="${project.name}"/>
        <attribute name="Implementation-Version" value="1.0"/>
      </manifest>

      <fileset dir="${project.build.outputDirectory}"/>
    </fx:jar>
  </target>

  <!-- Sign application jar. Use new self signed certificate -->
  <!-- Use blob signing for smaller jar size -->
  <target name="signjar" depends="jar">
    <delete file="${project.build.directory}/test.keystore"/>
    <genkey alias="signFiles"
            storepass="xyz123" keystore="${project.build.directory}/test.keystore"
            dname="CN=evan.flynn@gmail.com, C=US"/>

    <fx:signjar keystore="${project.build.directory}/test.keystore"
                alias="signFiles"
                storepass="xyz123"
                jar="${project.build.directory}/${project.name}.jar" />
  </target>

  <target name="deploy" depends="jar,signjar">
    <fx:deploy width="260"
               height="300"
               outdir="${project.build.directory}"
               outfile="${project.name}"
               embedJNLP="true">
      <fx:info title="${project.name}" />
      <fx:application refId="minesweeper"/>
      <fx:permissions elevated="true"/>
      <fx:resources refId="appRes"/>
    </fx:deploy>
  </target>
</project>
